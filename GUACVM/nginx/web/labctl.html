<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cyber sikkerheds labs</title>

<style>
  body { margin:0; font-family: Arial; background:#0f172a; color:#e5e7eb; }
  .layout { display:grid; grid-template-columns:260px 1fr; height:100vh; }

  .sidebar { background:#111827; border-right:1px solid #1f2937; padding:14px; }
  .title { font-size:22px; font-weight:bold; margin-bottom:10px; }

  .nav-title { margin-top:12px; font-size:12px; color:#9ca3af; text-transform:uppercase; }

  .nav-button, .conn-button {
    display:block; width:100%; margin-bottom:8px;
    padding:10px 12px; background:#1f2937; color:#fff;
    border-radius:6px; text-decoration:none;
    border:none; cursor:pointer;
  }
  .nav-button:hover, .conn-button:hover { background:#2563eb; }

  .content { padding:24px; overflow:auto; }

  /* VM GRID */
  .vm-grid {
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:16px;
    max-width:900px;
  }

  .vm-card {
    background:#111827;
    border:1px solid #1f2937;
    border-radius:12px;
    padding:14px;
  }

  .vm-buttons {
    display:flex;
    gap:8px;
  }

  .vm-buttons .nav-button {
    width:auto;
  }

</style>

<script>
  const HOST = window.location.hostname;

  function link(path="") {
    return `http://${HOST}${path}`;
  }

  function nat(port, https=false) {
    return `${https ? 'https' : 'http'}://${HOST}:${port}`;
  }

  function toggleKaliMenu() {
    const menu = document.getElementById("kaliMenu");
    if (menu.style.display === "none" || menu.style.display === "") {
      menu.style.display = "block";
    } else {
      menu.style.display = "none";
    }
  }
</script>

</head>

<body>
<div class="layout">

<!-- SIDEBAR -->
<div class="sidebar">

  <div class="title">Lab Portal</div>

  <div class="nav-title">Pages</div>
  <a class="nav-button" href="index.html">Home</a>
  <a class="nav-button" href="tasks.html">Tasks</a>
  <a class="nav-button" href="topology.html">Topology</a>
  <a class="nav-button" href="labctl.html">Lab control</a>

  <div class="nav-title">Connections</div>

  <div class="conn-button" onclick="toggleKaliMenu()" style="cursor:pointer;">
    Kali01 VNC â–¸
  </div>

  <div id="kaliMenu" style="display:none; margin-left:15px;">

  <a class="conn-button" target="_blank"
     href="#" onclick="this.href = link('/guacamole/#/client/NgBjAHBvc3RncmVzcWw')">
     User1
  </a>

  <a class="conn-button" target="_blank"
     href="#" onclick="this.href = link('/guacamole/#/client/MTMAYwBwb3N0Z3Jlc3Fs')">
     User2
  </a>

  <a class="conn-button" target="_blank"
     href="#" onclick="this.href = link('/guacamole/#/client/MTQAYwBwb3N0Z3Jlc3Fs')">
     User3
  </a>

  <a class="conn-button" target="_blank"
     href="#" onclick="this.href = link('/guacamole/#/client/MTUAYwBwb3N0Z3Jlc3Fs')">
     User4
  </a>

</div>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/MgBjAHBvc3RncmVzcWw')">Kali01 SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/MTAAYwBwb3N0Z3Jlc3Fs')">Client01 RDP</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/OQBjAHBvc3RncmVzcWw')">Client01 SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/MTIAYwBwb3N0Z3Jlc3Fs')">VULNSRV01 SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/NQBjAHBvc3RncmVzcWw')">VULNSRV02 SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/MQBjAHBvc3RncmVzcWw')">APPSRV01 SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = nat(9002, true)">Wazuh GUI</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/NABjAHBvc3RncmVzcWw')">Wazuh SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = nat(9003, true)">OPNsense GUI</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/OABjAHBvc3RncmVzcWw')">OPNsense SSH</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = link('/guacamole/#/client/NwBjAHBvc3RncmVzcWw')">WIN2025 RDP</a>
  <a class="conn-button" target="_blank" href="#" onclick="this.href = nat(9001, true)">Proxmox GUI</a>


</div>

<!-- CONTENT -->
<div class="content">

<h3>Virtual Machine Control</h3>
<p>Start, stop, reset and view status of each VM.</p>

<div class="vm-grid">

  <!-- VM cards -->
  <div class="vm-card">
    <h4>OPNsense</h4>
    Status: <span id="status-opnsense">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('opnsense','start')">Start</button>
      <button class="nav-button" onclick="vmAction('opnsense','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('opnsense','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>VULN-SRV01</h4>
    Status: <span id="status-vuln-srv01">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('vuln-srv01','start')">Start</button>
      <button class="nav-button" onclick="vmAction('vuln-srv01','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('vuln-srv01','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>VULN-SRV02</h4>
    Status: <span id="status-vuln-srv02">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('vuln-srv02','start')">Start</button>
      <button class="nav-button" onclick="vmAction('vuln-srv02','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('vuln-srv02','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>APPSRV01</h4>
    Status: <span id="status-appsrv01">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('appsrv01','start')">Start</button>
      <button class="nav-button" onclick="vmAction('appsrv01','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('appsrv01','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>Kali01</h4>
    Status: <span id="status-kali01">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('kali01','start')">Start</button>
      <button class="nav-button" onclick="vmAction('kali01','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('kali01','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>Client01</h4>
    Status: <span id="status-client01">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('client01','start')">Start</button>
      <button class="nav-button" onclick="vmAction('client01','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('client01','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>Wazuh</h4>
    Status: <span id="status-wazuh">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('wazuh','start')">Start</button>
      <button class="nav-button" onclick="vmAction('wazuh','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('wazuh','reset')">Reset</button>
    </div>
  </div>

  <div class="vm-card">
    <h4>WIN2025</h4>
    Status: <span id="status-win2025">Loading...</span><br><br>
    <div class="vm-buttons">
      <button class="nav-button" onclick="vmAction('win2025','start')">Start</button>
      <button class="nav-button" onclick="vmAction('win2025','stop')">Stop</button>
      <button class="nav-button" onclick="vmAction('win2025','reset')">Reset</button>
    </div>
  </div>

</div>

<br>

<button class="nav-button" style="background:#dc2626; max-width:300px;" onclick="resetAllVMs()">
  ðŸ”¥ Reset ALL VMs
</button>

</div>
</div>

<script>
const VMS = ["opnsense","vuln-srv01","vuln-srv02","appsrv01","kali01","client01","wazuh","win2025"];

function vmAction(vm, action) {
  fetch(`/api/vm/${vm}/${action}`, { method: "POST" })
    .then(r => r.json())
    .then(() => loadStatus(vm));
}

function loadStatus(vm) {
  fetch(`/api/vm/${vm}/status`)
    .then(r => r.json())
    .then(data => {
      const el = document.getElementById("status-" + vm);
      if (data.status === "running") {
        el.innerText = "running";
        el.style.color = "#22c55e";
      } else {
        el.innerText = "stopped";
        el.style.color = "#ef4444";
      }
    });
}

function resetAllVMs() {
  if(confirm("âš ï¸ This will reset ALL VMs. Are you sure?")) {
    fetch("/api/vm/resetall", { method: "POST" })
      .then(r => r.json())
      .then(() => alert("All VMs reset started"));
  }
}

VMS.forEach(loadStatus);
setInterval(() => { VMS.forEach(loadStatus); }, 5000);
</script>

</body>
</html>
