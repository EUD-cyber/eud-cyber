<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cyber sikkerheds labs</title>

<style>
  body { margin:0; font-family: Arial; background:#0f172a; color:#e5e7eb; }
  .layout { display:grid; grid-template-columns:260px 1fr; height:100vh; }

  .sidebar { background:#111827; border-right:1px solid #1f2937; padding:14px; }
  .title { font-size:22px; font-weight:bold; margin-bottom:10px; }

  .nav-title { margin-top:12px; font-size:12px; color:#9ca3af; text-transform:uppercase; }

  .nav-button, .conn-button {
    display:block; width:100%; margin-bottom:8px;
    padding:10px 12px; background:#1f2937; color:#fff;
    border-radius:6px; text-decoration:none;
  }
  .nav-button:hover, .conn-button:hover { background:#2563eb; }

  .content { padding:24px; overflow:auto; }
</style>

<script>
  const HOST = window.location.hostname;
  function link(path="") { return `http://${HOST}${path}`; }
  function nat(port, https=false) {
    return `${https?'https':'http'}://${HOST}:${port}`;
  }
</script>
</head>

<body>
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div class="title">Lab Portal</div>

    <div class="nav-title">Pages</div>
    <a class="nav-button" href="index.html">Topologi</a>
    <a class="nav-button" href="tasks.html">Tasks</a>
    <a class="nav-button" href="page3.html">Page 3</a>
    <a class="nav-button" href="page4.html">Page 4</a>

    <div class="nav-title">Connections</div>

    <!-- Guacamole connections -->
    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NwBjAHBvc3RncmVzcWw')">
       WIN2025
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/OABjAHBvc3RncmVzcWw')">
       OPNsense SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NABjAHBvc3RncmVzcWw')">
       Wazuh SSH
    </a>
    
    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/MQBjAHBvc3RncmVzcWw')">
       VULNSRV01 SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NQBjAHBvc3RncmVzcWw')">
       VULNSRV02 SSH
    </a>
    
    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NgBjAHBvc3RncmVzcWw')">
       Kali01 VNC
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/MgBjAHBvc3RncmVzcWw')">
       Kali01 SSH
    </a>

      <!-- NAT LINKS (now grouped under connections) -->
    <a class="conn-button" target="_blank"
     href="#"
     onclick="this.href = nat(9001, true)">
     Proxmox
    </a>
    <a class="conn-button" target="_blank"
       href="#"
       onclick="this.href = nat(9002, true)">
       Wazuh
    </a>
    <a class="conn-button" target="_blank"
       href="#"
       onclick="this.href = nat(9003)">
       OPNsense
    </a>
  
  </div>
  <div class="content">
<h2>Lab Control</h2>

<div class="task">
  <h3>VULNSRV01 â€“ Juiceshop</h3>
  <button onclick="startLab('juice-vuln1')">â–¶ Start</button>
  <button onclick="stopLab('juice-vuln1')">â–  Stop</button>
  <span id="status-juice-vuln1">Status: ...</span>
</div>

<hr>

<div class="task">
  <h3>VULNSRV02 â€“ Juiceshop</h3>
  <button onclick="startLab('juice-vuln2')">â–¶ Start</button>
  <button onclick="stopLab('juice-vuln2')">â–  Stop</button>
  <span id="status-juice-vuln2">Status: ...</span>
</div>

<script>
async function update(target) {
  try {
    const r = await fetch(`/api/${target}/status`);
    if (!r.ok) throw new Error("API error");

    const j = await r.json();
    document.getElementById(`status-${target}`).innerText =
      "Status: " + (j.status === "running" ? "ðŸŸ¢ running" : "ðŸ”´ stopped");

  } catch (e) {
    document.getElementById(`status-${target}`).innerText =
      "Status: âš ï¸ API error";
  }
}

async function startLab(target) {
  await fetch(`/api/${target}/start`);
  setTimeout(() => update(target), 1500);
}

async function stopLab(target) {
  await fetch(`/api/${target}/stop`);
  setTimeout(() => update(target), 1500);
}

// Initial load
update("juice-vuln1");
update("juice-vuln2");

// Auto refresh every 5s
setInterval(() => {
  update("juice-vuln1");
  update("juice-vuln2");
}, 5000);
</script>

</div>


</div>
</body>
</html>
