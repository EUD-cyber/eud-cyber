<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cyber sikkerheds labs</title>

<style>
  body { margin:0; font-family: Arial; background:#0f172a; color:#e5e7eb; }
  .layout { display:grid; grid-template-columns:260px 1fr; height:100vh; }

  .sidebar { background:#111827; border-right:1px solid #1f2937; padding:14px; }
  .title { font-size:22px; font-weight:bold; margin-bottom:10px; }

  .nav-title { margin-top:12px; font-size:12px; color:#9ca3af; text-transform:uppercase; }

  .nav-button, .conn-button {
    display:block; width:100%; margin-bottom:8px;
    padding:10px 12px; background:#1f2937; color:#fff;
    border-radius:6px; text-decoration:none;
  }
  .nav-button:hover, .conn-button:hover { background:#2563eb; }

  .content { padding:24px; overflow:auto; }
</style>

<script>
  const HOST = window.location.hostname;
  function link(path="") { return `http://${HOST}${path}`; }
  function nat(port, https=false) {
    return `${https?'https':'http'}://${HOST}:${port}`;
  }
</script>
</head>

<body>
<div class="layout">

  <!-- SIDEBAR -->
  <div class="sidebar">

    <div class="title">Lab Portal</div>

    <div class="nav-title">Pages</div>
    <a class="nav-button" href="index.html">Home</a>
    <a class="nav-button" href="tasks.html">Tasks</a>
    <a class="nav-button" href="topology.html">Topology</a>
    <a class="nav-button" href="labctl.html">Lab control</a>

    <div class="nav-title">Connections</div>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NgBjAHBvc3RncmVzcWw')">
       Kali01 VNC
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/MgBjAHBvc3RncmVzcWw')">
       Kali01 SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/MTAAYwBwb3N0Z3Jlc3Fs')">
       Client01 RDP
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/OQBjAHBvc3RncmVzcWw')">
       Client01 SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/MTIAYwBwb3N0Z3Jlc3Fs')">
       VULNSRV01 SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NQBjAHBvc3RncmVzcWw')">
       VULNSRV02 SSH
    </a>

     <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/MQBjAHBvc3RncmVzcWw')">
       APPSRV01 SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = nat(9002, true)">
       Wazuh GUI
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NABjAHBvc3RncmVzcWw')">
       Wazuh SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = nat(9003, true)">
       OPNsense GUI
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/OABjAHBvc3RncmVzcWw')">
       OPNsense SSH
    </a>

    <a class="conn-button" target="_blank"
       href="#" onclick="this.href = link('/guacamole/#/client/NwBjAHBvc3RncmVzcWw')">
       WIN2025 RDP
    </a>

    <a class="conn-button" target="_blank"
     href="#" onclick="this.href = nat(9001, true)">
     Proxmox GUI
    </a>

   

  </div>
  <div class="content">
<h2>Lab Control</h2>

<div class="task">
  <h3>VULNSRV01 ‚Äì Juiceshop</h3>
  <button onclick="startLab('juice-vuln1')">‚ñ∂ Start</button>
  <button onclick="stopLab('juice-vuln1')">‚ñ† Stop</button>
  <span id="status-juice-vuln1">Status: ...</span>
</div>

<hr>

<div class="task">
  <h3>VULNSRV02 ‚Äì Juiceshop</h3>
  <button onclick="startLab('juice-vuln2')">‚ñ∂ Start</button>
  <button onclick="stopLab('juice-vuln2')">‚ñ† Stop</button>
  <span id="status-juice-vuln2">Status: ...</span>
</div>

<hr>

<div class="task">
  <h3>VULNSRV01 ‚Äì DVWA</h3>
  <button onclick="startLab('dvwa-vuln1')">‚ñ∂ Start</button>
  <button onclick="stopLab('dvwa-vuln1')">‚ñ† Stop</button>
  <span id="status-dvwa-vuln1">Status: ...</span>
</div>

<hr>

<div class="task">
  <h3>VULNSRV02 ‚Äì DVWA</h3>
  <button onclick="startLab('dvwa-vuln2')">‚ñ∂ Start</button>
  <button onclick="stopLab('dvwa-vuln2')">‚ñ† Stop</button>
  <span id="status-dvwa-vuln2">Status: ...</span>
</div>

<hr>
    
<div class="task">
  <h3>APPSRV01 ‚Äì Suricata</h3>
  <button onclick="startLab('suricata-appsrv01')">‚ñ∂ Start</button>
  <button onclick="stopLab('suricata-appsrv01')">‚ñ† Stop</button>
  <span id="status-suricata-appsrv01">Status: ...</span>
</div>

<hr>

<div class="task">
  <h3>APPSRV01 ‚Äì Radius</h3>
  <button onclick="startLab('radius-appsrv01')">‚ñ∂ Start</button>
  <button onclick="stopLab('radius-appsrv01')">‚ñ† Stop</button>
  <span id="status-radius-appsrv01">Status: ...</span>
</div>

<hr>
    
<div class="task">
  <h3>LAN1 ‚Äì Traffic Mirror</h3>
  <button onclick="enableMirror('kali')">ü™û Enable Kali</button>
  <button onclick="enableMirror('appsrv')">ü™û Enable APPSRV01</button>
  <button onclick="disableMirror()">‚ùå Disable</button>
  <span id="status-mirror">Status: ...</span>
</div>




<script>
async function update(target) {
  try {
    const r = await fetch(`/api/${target}/status`);
    if (!r.ok) throw new Error("API error");

    const j = await r.json();
    document.getElementById(`status-${target}`).innerText =
      "Status: " + (j.status === "running" ? "üü¢ running" : "üî¥ stopped");

  } catch (e) {
    document.getElementById(`status-${target}`).innerText =
      "Status: ‚ö†Ô∏è API error";
  }
}
async function startLab(target) {
  await fetch(`/api/${target}/start`);
  setTimeout(() => update(target), 1500);
}

async function stopLab(target) {
  await fetch(`/api/${target}/stop`);
  setTimeout(() => update(target), 1500);
}

async function updateMirror() {
  try {
    const r = await fetch(`/api/mirror/status`);
    const j = await r.json();

    if (j.active_mirror) {
      document.getElementById("status-mirror").innerText =
        "Status: ü™û active ‚Üí " + j.active_mirror;
    } else {
      document.getElementById("status-mirror").innerText =
        "Status: üî¥ disabled";
    }

  } catch (e) {
    document.getElementById("status-mirror").innerText =
      "Status: ‚ö†Ô∏è API error";
  }
}

async function enableMirror(target) {
  await fetch(`/api/mirror/${target}/enable`, { method: "POST" });
  setTimeout(updateMirror, 1000);
}

async function disableMirror() {
  await fetch(`/api/mirror/disable`, { method: "POST" });
  setTimeout(updateMirror, 1000);
}

/* initial load */
updateMirror();

// Initial load
update("juice-vuln1");
update("juice-vuln2");
update("dvwa-vuln1");
update("dvwa-vuln2");
update("suricata-appsrv01");
update("radius-appsrv01");

// Auto refresh every 5s
setInterval(() => {
  update("juice-vuln1");
  update("juice-vuln2");
  update("dvwa-vuln1");
  update("dvwa-vuln2");
  update("suricata-appsrv01");
  update("radius-appsrv01");
  updateMirror();
}, 5000);
</script>

</div>


</div>
</body>
</html>
